<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Fireworks</title>
<style>
html,body{
    margin:0;
    padding:0;
    background:black;
    overflow:hidden;
}
canvas{
    display:block;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = window.innerWidth;
    canvas.height
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const gravity = 0.06;
const friction = 0.98;
const fireworks = [];
const particles = [];

function random(min, max){
    return Math.random() * (max - min) + min;
}

class Firework{
    constructor(){
        this.x = random(0, canvas.width);
        this.y = canvas.height;
        this.targetY = random(canvas.height * 0.2, canvas.height * 0.5);
        this.speed = random(7, 10);
        this.angle = -Math.PI / 2;
        this.hue = random(0, 360);
        this.brightness = random(60, 80);
    }

    update(){
        this.y += Math.sin(this.angle) * this.speed;
        this.speed *= 0.99;

        if(this.y <= this.targetY){
            explode(this.x, this.y, this.hue);
            return true;
        }
        return false;
    }

    draw(){
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = `hsl(${this.hue},100%,${this.brightness}%)`;
        ctx.fill();
    }
}

class Particle{
    constructor(x,y,hue){
        this.x = x;
        this.y = y;
        this.angle = random(0, Math.PI * 2);
        this.speed = random(2, 6);
        this.friction = friction;
        this.gravity = gravity;
        this.hue = hue + random(-30,30);
        this.brightness = random(60,80);
        this.alpha = 1;
        this.decay = random(0.008, 0.015);
    }

    update(){
        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= this.decay;
        return this.alpha <= 0;
    }

    draw(){
        ctx.beginPath();
        ctx.arc(this.x,this.y,2,0,Math.PI*2);
        ctx.fillStyle = `hsla(${this.hue},100%,${this.brightness}%,${this.alpha})`;
        ctx.fill();
    }
}

function explode(x,y,hue){
    const layers = Math.floor(random(2,4)); // nổ nhiều tầng
    for(let l=0; l<layers; l++){
        setTimeout(()=>{
            for(let i=0;i<80;i++){
                particles.push(new Particle(x,y,hue + l*40));
            }
        }, l * 120);
    }
}

function animate(){
    requestAnimationFrame(animate);

    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(let i=fireworks.length-1;i>=0;i--){
        fireworks[i].draw();
        if(fireworks[i].update()){
            fireworks.splice(i,1);
        }
    }

    for(let i=particles.length-1;i>=0;i--){
        particles[i].draw();
        if(particles[i].update()){
            particles.splice(i,1);
        }
    }

    if(Math.random() < 0.04){
        fireworks.push(new Firework());
    }
}

animate();
</script>
</body>
</html>
